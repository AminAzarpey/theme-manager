{"version":3,"file":"core.js","sources":["../src/js/core.js"],"sourcesContent":["// core.js\r\n\r\nconst THEME_KEY = \"tm_theme\";\r\nconst PALETTE_KEY = \"tm_palette\";\r\nconst DIRECTION_KEY = \"tm_dir\";\r\n\r\nlet currentTheme;\r\nlet currentPalette;\r\nlet currentDirection;\r\nlet baseHref = \"dist\";\r\nconst themeLinkId = \"theme-css\";\r\n\r\n/**\r\n * Dispatches a custom theme change event.\r\n */\r\nfunction emitThemeChange() {\r\n    const detail = {\r\n        theme: currentTheme,\r\n        palette: currentPalette,\r\n        direction: currentDirection,\r\n    };\r\n    window.dispatchEvent(new CustomEvent(\"themeChange\", { detail }));\r\n}\r\n\r\nfunction resolveInitialConfig(config = {}) {\r\n    currentTheme =\r\n        (!config.ignoreStorage && localStorage.getItem(THEME_KEY)) ||\r\n        config.theme ||\r\n        (window.matchMedia(\"(prefers-color-scheme: dark)\").matches ? \"dark\" : \"light\");\r\n\r\n    currentPalette =\r\n        (!config.ignoreStorage && localStorage.getItem(PALETTE_KEY)) ||\r\n        config.palette ||\r\n        \"default\";\r\n\r\n    currentDirection =\r\n        (!config.ignoreStorage && localStorage.getItem(DIRECTION_KEY)) ||\r\n        config.direction ||\r\n        \"ltr\";\r\n\r\n    baseHref = config.baseHref || baseHref;\r\n}\r\n\r\nfunction applyCssFile() {\r\n    const fileName = `theme-${currentTheme}.${currentPalette}${\r\n        currentDirection === \"rtl\" ? \".rtl\" : \".ltr\"\r\n    }.css`;\r\n    const href = `${baseHref}/${fileName}`;\r\n    const linkTag = document.getElementById(themeLinkId);\r\n\r\n    document.body.className = `theme-${currentTheme} palette-${currentPalette}`;\r\n    document.documentElement.setAttribute(\"dir\", currentDirection);\r\n\r\n    if (linkTag) {\r\n        linkTag.setAttribute(\"href\", href);\r\n    } else {\r\n        const link = document.createElement(\"link\");\r\n        link.id = themeLinkId;\r\n        link.rel = \"stylesheet\";\r\n        link.href = href;\r\n        document.head.appendChild(link);\r\n    }\r\n}\r\n\r\n/**\r\n * Initializes the theme system.\r\n * @param {ThemeConfig} config\r\n */\r\nexport function initThemeSystem(config = {}) {\r\n    resolveInitialConfig(config);\r\n    applyCssFile();\r\n    emitThemeChange(); // NEW\r\n}\r\n\r\n/**\r\n * Toggles between 'light' and 'dark' theme.\r\n */\r\nexport function toggleTheme() {\r\n    const next = currentTheme === \"light\" ? \"dark\" : \"light\";\r\n    setTheme(next);\r\n}\r\n\r\n/**\r\n * Sets a new theme.\r\n * @param {string} theme\r\n */\r\nexport function setTheme(theme) {\r\n    currentTheme = theme;\r\n    localStorage.setItem(THEME_KEY, theme);\r\n    applyCssFile();\r\n    emitThemeChange(); // NEW\r\n}\r\n\r\n/**\r\n * Applies a new palette.\r\n * @param {string} palette\r\n */\r\nexport function applyPalette(palette) {\r\n    currentPalette = palette;\r\n    localStorage.setItem(PALETTE_KEY, palette);\r\n    applyCssFile();\r\n    emitThemeChange(); // NEW\r\n}\r\n\r\n/**\r\n * Sets the text direction.\r\n * @param {'ltr' | 'rtl'} dir\r\n */\r\nexport function setDirection(dir) {\r\n    currentDirection = dir;\r\n    localStorage.setItem(DIRECTION_KEY, dir);\r\n    applyCssFile();\r\n    emitThemeChange(); // NEW\r\n}\r\n\r\nexport function toggleDirection() {\r\n    const next = currentDirection === \"ltr\" ? \"rtl\" : \"ltr\";\r\n    setDirection(next);\r\n}\r\n\r\nexport function resetThemeSystem() {\r\n    localStorage.removeItem(THEME_KEY);\r\n    localStorage.removeItem(PALETTE_KEY);\r\n    localStorage.removeItem(DIRECTION_KEY);\r\n    initThemeSystem();\r\n}\r\n\r\nexport function getCurrentConfig() {\r\n    return {\r\n        theme: currentTheme,\r\n        palette: currentPalette,\r\n        direction: currentDirection,\r\n    };\r\n}\r\n"],"names":["THEME_KEY","PALETTE_KEY","DIRECTION_KEY","currentTheme","currentPalette","currentDirection","baseHref","themeLinkId","emitThemeChange","detail","theme","palette","direction","window","dispatchEvent","CustomEvent","applyCssFile","href","linkTag","document","getElementById","body","className","documentElement","setAttribute","link","createElement","id","rel","head","appendChild","initThemeSystem","config","ignoreStorage","localStorage","getItem","matchMedia","matches","resolveInitialConfig","setTheme","setItem","setDirection","dir","removeItem"],"mappings":"mPAEA,MAAMA,EAAY,WACZC,EAAc,aACdC,EAAgB,SAEtB,IAAIC,EACAC,EACAC,EACAC,EAAW,OACf,MAAMC,EAAc,YAKpB,SAASC,IACL,MAAMC,EAAS,CACXC,MAAOP,EACPQ,QAASP,EACTQ,UAAWP,GAEfQ,OAAOC,cAAc,IAAIC,YAAY,cAAe,CAAEN,WAC1D,CAqBA,SAASO,IACL,MAGMC,EAAO,GAAGX,KAHC,SAASH,KAAgBC,IACjB,QAArBC,EAA6B,OAAS,eAGpCa,EAAUC,SAASC,eAAeb,GAKxC,GAHAY,SAASE,KAAKC,UAAY,SAASnB,aAAwBC,IAC3De,SAASI,gBAAgBC,aAAa,MAAOnB,GAEzCa,EACAA,EAAQM,aAAa,OAAQP,OAC1B,CACH,MAAMQ,EAAON,SAASO,cAAc,QACpCD,EAAKE,GAAKpB,EACVkB,EAAKG,IAAM,aACXH,EAAKR,KAAOA,EACZE,SAASU,KAAKC,YAAYL,EAC9B,CACJ,CAMO,SAASM,EAAgBC,EAAS,KA5CzC,SAA8BA,EAAS,IACnC7B,GACM6B,EAAOC,eAAiBC,aAAaC,QAAQnC,IAC/CgC,EAAOtB,QACNG,OAAOuB,WAAW,gCAAgCC,QAAU,OAAS,SAE1EjC,GACM4B,EAAOC,eAAiBC,aAAaC,QAAQlC,IAC/C+B,EAAOrB,SACP,UAEJN,GACM2B,EAAOC,eAAiBC,aAAaC,QAAQjC,IAC/C8B,EAAOpB,WACP,MAEJN,EAAW0B,EAAO1B,UAAYA,CAClC,CA4BIgC,CAAqBN,GACrBhB,IACAR,GACJ,CAcO,SAAS+B,EAAS7B,GACrBP,EAAeO,EACfwB,aAAaM,QAAQxC,EAAWU,GAChCM,IACAR,GACJ,CAiBO,SAASiC,EAAaC,GACzBrC,EAAmBqC,EACnBR,aAAaM,QAAQtC,EAAewC,GACpC1B,IACAR,GACJ,gBAhBO,SAAsBG,GACzBP,EAAiBO,EACjBuB,aAAaM,QAAQvC,EAAaU,GAClCK,IACAR,GACJ,qBAyBO,WACH,MAAO,CACHE,MAAOP,EACPQ,QAASP,EACTQ,UAAWP,EAEnB,yCAbO,WACH6B,aAAaS,WAAW3C,GACxBkC,aAAaS,WAAW1C,GACxBiC,aAAaS,WAAWzC,GACxB6B,GACJ,kDAVO,WAEHU,EADkC,QAArBpC,EAA6B,MAAQ,MAEtD,gBAzCO,WAEHkC,EAD8B,UAAjBpC,EAA2B,OAAS,QAErD"}